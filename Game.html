<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>thaococo Quiz Game</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
:root {
    --primary: #4dabf7;
    --secondary: #1c7ed6;
    --success: #37b24d;
    --danger: #fa5252;
    --dark-bg: #0a1f40;
    --light-bg: rgba(30,60,120,0.85);
    --card-text: #fff;
    --icon-color: #fffb;
}
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: 'Poppins', sans-serif; background-color: var(--dark-bg); color: var(--card-text); min-height: 100vh; display:flex; flex-direction:column; align-items:center; overflow-x:hidden; position:relative; }
body::before { content:""; position:fixed; inset:0; background:url('https://images.unsplash.com/photo-1509062522246-3755977927d7?auto=format&fit=crop&w=1920&q=80') center/cover no-repeat; filter: blur(6px) brightness(0.55); z-index:-2; }
#snow { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow:hidden; z-index:-1; }
.snowflake { position:absolute; top:-10px; color:#fff; font-size:1em; opacity:0.8; animation-name:fall; animation-timing-function:linear; animation-iteration-count:infinite; }
@keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity:1; } 100% { transform: translateY(110vh) rotate(360deg); opacity:0.8; } }
.container { max-width: 900px; margin: 50px auto; padding: 30px 40px; border-radius: 20px; background: var(--light-bg); backdrop-filter: blur(8px); box-shadow: 0 25px 80px rgba(0,0,0,0.35); width:90%; display:flex; flex-direction:column; align-items:center; }
header { background-color: var(--primary); color:white; text-align:center; padding:20px; font-size:28px; font-weight:bold; border-radius:15px; margin-bottom:25px; box-shadow:0 5px 20px rgba(0,0,0,0.3);}
input[type=text]{ width:80%; padding:14px; border-radius:12px; border:none; margin-bottom:16px; font-size:18px; text-align:left; box-shadow:0 4px 15px rgba(0,0,0,0.3); transition:0.3s; }
input[type=text]::placeholder { text-align:left; }
input[type=text]:focus{ outline:none; transform:scale(1.02); box-shadow:0 6px 25px rgba(0,0,0,0.5); }
button{ cursor:pointer; border:none; border-radius:12px; padding:14px 28px; font-weight:bold; transition:all 0.2s; font-size:18px; background:linear-gradient(135deg, #4dabf7, #1c7ed6); color:#fff; }
button:hover{ transform:scale(1.05); box-shadow:0 5px 15px rgba(0,0,0,0.5);}
#balance, #target, #market{ font-size:20px; font-weight:bold; background:rgba(0,0,0,0.45); padding:10px 20px; border-radius:15px; margin-top:10px; display:flex; align-items:center; gap:10px; box-shadow:0 2px 10px rgba(0,0,0,0.4);}
#board{ position: fixed; top:20px; left:50%; transform:translateX(-50%); padding:15px 25px; border-radius:12px; font-size:22px; font-weight:bold; display:none; z-index:9999; color:#fff; text-shadow:1px 1px 3px #000; transition:0.3s all;}
#question-area{ font-size:22px; font-weight:bold; margin-top:20px; text-align:center; text-shadow:1px 1px 2px #000; }
.answer-grid{ display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:20px 0; width:100%; }
.answer-card{ padding:35px; border-radius:15px; font-size:20px; text-align:center; font-weight:bold; color:var(--card-text); cursor:pointer; transition:all 0.3s; box-shadow:0 4px 15px rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; gap:10px; }
.answer-card:hover{ transform:scale(1.05); box-shadow:0 6px 25px rgba(0,0,0,0.6);}
.blue{ background:#4dabf7;} .green{ background:#37b24d;} .red{ background:#fa5252;} .yellow{ background:#fcc419;}
#shop{ display:none; margin-top:20px; width:100%; background:rgba(0,0,0,0.3); border-radius:15px; padding:15px;}
.upgrade{ display:flex; justify-content:space-between; align-items:center; background:rgba(77,171,247,0.15); padding:12px 15px; border-radius:12px; margin-bottom:8px; }
.upgrade button{ background:var(--primary); color:#fff;}
#endgame{ display:none; text-align:center;}
.upgrade span i{ color:var(--icon-color); margin-right:6px;}
.modal{ display:flex; position:fixed; inset:0; justify-content:center; align-items:center; background:rgba(0,0,0,0.7); backdrop-filter:blur(5px); z-index:9999;}
.modal-content{ background:var(--light-bg); padding:25px 35px; border-radius:20px; text-align:center; max-width:500px; width:90%; animation:slideUp 0.4s ease;}
@keyframes slideUp{ from{transform:translateY(30px);opacity:0;} to{transform:translateY(0);opacity:1;} }
</style>
</head>
<body>
<audio id="xmasMusic" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>
<div id="snow"></div>
<header>Ez10 Quiz Game</header>

<div id="howToPlay" class="modal">
<div class="modal-content">
<h2>C√°ch ch∆°i</h2>
<p>1. Nh·∫≠p code v√† t√™n</p>
<p>2. Tr·∫£ l·ªùi c√¢u h·ªèi</p>
<p>3. Nh·∫≠n ti·ªÅn</p>
<p>4. M·ªü shop ƒë·ªÉ n√¢ng c·∫•p.</p>
<p>5. ƒê·∫°t s·ªë ti·ªÅn y√™u c·∫ßu ƒë·ªÉ k·∫øt th√∫c!</p>
<button onclick="startAfterModal()">B·∫Øt ƒë·∫ßu</button>
</div>
</div>

<div class="container" id="start-container" style="display:none;">
<h3>ƒêi·ªÅn code v√† t√™n</h3>
<input type="text" id="playerCode" placeholder="NH·∫≠p Code">
<input type="text" id="playerName" placeholder="Nh·∫≠p T√™n">
<button onclick="joinGame()"><i class="fa-solid fa-play"></i> Tham gia</button>
</div>

<div class="container" id="game-container" style="display:none;">
<div id="board"></div>
<div id="balance"><i class="fa-solid fa-wallet"></i> S·ªë ti·ªÅn hi·ªán t·∫°i: $<span id="money">0</span></div>
<div id="target"><i class="fa-solid fa-bullseye"></i> M·ª•c ti√™u: $<span id="targetMoney">50</span></div>
<div id="market"><i class="fa-solid fa-chart-line"></i> Th·ªã tr∆∞·ªùng ch·ª©ng kho√°ng: $<span id="marketPrice">10</span></div>
<div id="question-area"></div>
<div class="answer-grid" id="answer-grid"></div>
<button onclick="openShop()"><i class="fa-solid fa-store"></i> Shop</button>
<div id="shop">
<h3> Shop n√¢ng c·∫•p</h3>
<div id="upgrade-list"></div>
<button onclick="closeShop()">ƒê√≥ng Shop</button>
</div>
</div>

<div class="container" id="endgame">
<h3>üéâ Tr√≤ ch∆°i k·∫øt th√∫c</h3>
<p>S·ªë ti·ªÅn ƒë√£ ƒë·∫°t ch·ªâ ƒë·ªãnh!</p>
<p>S·ªë ti·ªÅn ki·∫øm ƒë∆∞·ª£c: $<span id="finalMoney"></span></p>
<p>CC√¢u tr·∫£ l·ªùi ƒëu√∫ng: <span id="correctRate"></span></p>
<button onclick="restartGame()"><i class="fa-solid fa-rotate-right"></i> Ch∆°i l·∫°i</button>
</div>

<script>
// Continuous snow
function createSnow(){const snow=document.getElementById('snow');for(let i=0;i<80;i++){let f=document.createElement('div');f.className='snowflake';f.textContent='‚ùÑ';f.style.left=Math.random()*100+'%';f.style.fontSize=(12+Math.random()*20)+'px';f.style.animationDuration=(5+Math.random()*10)+'s';f.style.animationDelay=Math.random()*10+'s';snow.appendChild(f);}} createSnow();

// Game state
let player={name:'',code:'',money:0};
let questions=[];
let questionNumber=0;
let correctAnswers=0;
let targetMoney=50;
let startTime;
let upgradeEffects=[];
let marketPrice=10;
let globalQuestionNumber=0;
let currentKit=null;
const upgrades=[
{name:"Nh√¢n ƒë√¥i thu nh·∫≠p", cost:20, effect:'double', duration:3, desc:"Nh√¢n ƒë√¥i thu nh·∫≠p cho 3 c√¢u h·ªèi", icon:'fa-solid fa-bolt'},
{name:"X3 ho·∫∑c m·∫•t h·∫øt", cost:25, effect:'triple', duration:3, desc:"ƒê√∫ng s·∫Ω x3 sai th√¨ tr·ª´ x3, 2 v√≤ng", icon:'fa-solid fa-fire'},
{name:"Tham gia th·ªã tr∆∞·ªùng l√†m th√™m, 3 v√≤ng", cost:30, effect:'market', duration:3, desc:"Th√™m ho·∫∑c gi·∫£m thu nh·∫≠p tu√πy th·ªã tru·ªùng", icon:'fa-solid fa-chart-line'},
{name:"Ph·∫ßn th∆∞·ªüng th√™m", cost:15, effect:'extra', duration:3, desc:"Th√™m thu nh·∫≠p bonus, 3 v√≤ng", icon:'fa-solid fa-gift'},
{name:"Nh√¢n l√™n", cost:20, effect:'multiplier', duration:3, desc:"TƒÉng thu nh·∫≠p l√™n 20%, 3 v√≤ng", icon:'fa-solid fa-star'},
{name:"ƒê·∫ßu t∆∞", cost:25, effect:'invest', duration:3, desc:"Th·ª≠ t√†i ƒë·∫ßu t∆∞ d·ª±a v√†o th·ªã tr∆∞·ªùng, 3 v√≤ng", icon:'fa-solid fa-coins'},
{name:"V√≤ng quay may m·∫Øn", cost:18, effect:'lucky', duration:3, desc:"Bonus mi·ªÖn ph√≠ t·ª´ 1 - 5 ƒë√¥-la", icon:'fa-solid fa-dice'}
];

// Modal
function startAfterModal(){
    document.getElementById('howToPlay').style.display='none';
    document.getElementById('start-container').style.display='flex';
    const music = document.getElementById('xmasMusic');
    music.play().catch(e=>console.log("Autoplay prevented:", e));
}

// Ensure correct answers exist
function fixKitQuestions(kit){ kit.questions.forEach(q=>{ if(q.correct===undefined || q.correct===null){ q.correct=0; } else { if(typeof q.correct==='string' && !q.choices.includes(q.correct)) q.correct=0; if(typeof q.correct==='number'&&(q.correct<0||q.correct>=q.choices.length)) q.correct=0; } }); }

// Join game
function joinGame(){
    let code=document.getElementById('playerCode').value.trim();
    let name=document.getElementById('playerName').value.trim();
    if(!code||!name){alert('Enter both!'); return;}
    let allKits=JSON.parse(localStorage.getItem('userKits_v5')||'{}');
    let kit=null;
    for(let user in allKits){ kit=allKits[user].find(k=>k.assigned && k.assignedCode==code); if(kit) break; }
    if(!kit){alert('Invalid kit code'); return;}
    fixKitQuestions(kit);
    player={name, code, money:0};
    targetMoney=kit.targetMoney||50;
    questions=[...kit.questions];
    questionNumber=0;
    correctAnswers=0;
    currentKit=kit;
    document.getElementById('targetMoney').textContent=targetMoney;
    document.getElementById('start-container').style.display='none';
    document.getElementById('game-container').style.display='flex';
    startTime=Date.now();
    generateQuestion();
    updateMarket();
}

// Generate question
function generateQuestion(){
    if(questions.length===0) return;
    if(questionNumber>=questions.length) questionNumber=0;
    let q=questions[questionNumber];
    const qa=document.getElementById('question-area');
    const grid=document.getElementById('answer-grid');
    qa.textContent=`Question ${globalQuestionNumber+1} ($${globalQuestionNumber+1}) : ${q.question}`;
    grid.innerHTML='';
    q.choices.forEach((choice,i)=>{
        let card=document.createElement('div');
        card.className=`answer-card ${['blue','green','red','yellow'][i%4]}`;
        card.textContent=choice;
        card.onclick = ()=>{
            let isCorrect=(typeof q.correct==='number')? i===q.correct : choice.trim()===q.correct.trim();
            checkAnswer(isCorrect, globalQuestionNumber+1);
        }
        grid.appendChild(card);
    });
}

// Check answer
function checkAnswer(isCorrect, baseMoney){
    let earned=isCorrect? baseMoney : -baseMoney;
    upgradeEffects.forEach(u=>{
        if(u.effect==='double') earned*=2;
        if(u.effect==='triple'){ earned*=3; if(Math.random()<0.3) earned*=-1; }
        if(u.effect==='extra') earned+=Math.floor(Math.random()*(baseMoney/2)+1);
        if(u.effect==='market') earned+=(Math.random()<0.5?-5:5);
        if(u.effect==='invest') earned+=Math.round((marketPrice-10)*2);
        if(u.effect==='multiplier') earned=Math.floor(earned*1.2);
        if(u.effect==='lucky') earned+=Math.floor(Math.random()*5+1);
    });
    player.money+=earned;
    document.getElementById('money').textContent=player.money;
    const board=document.getElementById('board');
    board.style.display='block';
    board.style.background=isCorrect?'rgba(55,178,77,0.9)':'rgba(220,75,69,0.9)';
    board.textContent=isCorrect?`Correct! +$${earned}`:`Wrong! $${earned}`;
    setTimeout(()=>{board.style.display='none';},1200);
    correctAnswers+=isCorrect?1:0;
    upgradeEffects=upgradeEffects.map(u=>({...u,duration:u.duration-1})).filter(u=>u.duration>0);
    questionNumber++;
    globalQuestionNumber++;
    if(player.money>=targetMoney){ endGame(); return; }
    setTimeout(generateQuestion,1500);
}

// Shop
function openShop(){
    const shop=document.getElementById('shop');
    shop.style.display='block';
    const list=document.getElementById('upgrade-list');
    list.innerHTML='';
    upgrades.forEach((u,i)=>{
        const row=document.createElement('div');
        row.className='upgrade';
        row.innerHTML=`<span><i class="${u.icon}"></i>${u.name}: ${u.desc}</span><button onclick="buyUpgrade(${i})">Buy ($${u.cost})</button>`;
        list.appendChild(row);
    });
}
function closeShop(){ document.getElementById('shop').style.display='none'; }
function buyUpgrade(i){
    let u=upgrades[i];
    if(player.money<u.cost){alert('Not enough money!'); return;}
    player.money-=u.cost;
    upgradeEffects.push({...u});
    document.getElementById('money').textContent=player.money;
    alert(`${u.name} purchased!`);
}

// Market
function updateMarket(){ marketPrice+=Math.floor(Math.random()*3-1); if(marketPrice<1) marketPrice=1; document.getElementById('marketPrice').textContent=marketPrice; setTimeout(updateMarket,5000); }

// End game
function endGame(){
    document.getElementById('game-container').style.display='none';
    document.getElementById('endgame').style.display='block';
    document.getElementById('finalMoney').textContent=player.money;
    document.getElementById('correctRate').textContent=correctAnswers;
    let perf=JSON.parse(localStorage.getItem('studentStats')||'{}');
    if(!perf[player.name]) perf[player.name]=[];
    perf[player.name].push({kitCode:player.code, score:player.money, correct:correctAnswers, total:questions.length, date:Date.now()});
    localStorage.setItem('studentStats', JSON.stringify(perf));
}

// Restart
function restartGame(){
    document.getElementById('endgame').style.display='none';
    document.getElementById('game-container').style.display='flex';
    questionNumber=0;
    globalQuestionNumber=0;
    player.money=0;
    document.getElementById('money').textContent=player.money;
    upgradeEffects=[];
    generateQuestion();
}
</script>
</body>
</html>
